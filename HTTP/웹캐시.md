### ✨웹 캐시란 무엇인가요?

자주 쓰이는 문서의 사본을 자동으로 보관하는 HTTP 장치입니다.

## 🔁꼬리질문

## 🤔웹 캐시는 무슨 장점이 있나요?

- 캐시는 불필요한 데이터 전송을 줄여서, 네트워크 요금으로 인한 비용을 줄여줍니다.

- 캐시는 네트워크 병목을 줄여줍니다. 대역폭을 늘리지않고, 페이지를 빨리 불러옵니다.

- 캐시는 원 서버에 대한 요청을 줄여줍니다. 서버는 부하를 줄일 수 있으며 더 빨리 응답할 수 있게 됩니다.

- 페이지를 먼 곳에서 불러올수록 시간이 많이 걸리는데, 캐시는 거리로 인한 지연을 줄여줍니다.

## 🤔그럼 캐시는 무조건 유용한 것인가요? 캐시 적중과 부적중에 대해서 아시나요?

캐시가 세상 모든 문서의 사본을 저장하지는 않습니다.

캐시에 요청이 도착했을 때 만약 그에 대응하는 사본이 있다면 그를 이용해 요청이 처리될 수 있습니다.

이를 `캐시 적중`이라 부릅니다.

만약 대응하는 사본이 없다면 그냥 원 서버에 전달 되기만 할 뿐입니다.

이를 `캐시 부적중`이라 부릅니다.

## 🤔만약 캐시된 문서가 최신화 되어 있지 않다면 어떻게 되나요?

원 서버 콘텐츠는 변경될 수 있기 때문에 캐시는 반드시 갖고있는 사본이 최신인지 서버를 통해 때때로 점검해야합니다.

이러한 신선도 검사를 `HTTP 재검사`라고 합니다.

캐시는 스스로 원한다면 언제든지 사본을 재검사할 수 있습니다.

그러나 캐시가 문서를 수백만 개씩 갖고있는 경우가 흔한데 비해 네트워크 대역폭은 부족하기 때문에 대부분의 캐시는 클라이언트가 사본을 요청하였으며 그 사본이 검사를 할 필요가 있을 정도로 충분히 오래된 경우에만 재검사를 진행합니다.

## 🤔그럼 HTTP 재검사가 어떻게 이루어지는지 간단하게 알 수 있을까요?

캐시는 캐시된 사본의 재검사가 필요할 때 작은 재검사 요청을 보냅니다.

콘텐츠가 변경되지 않았다면 서버는 아주 작은 `304 Not Modified` 응답을 보냅니다.

이를 `재검사` 적중 혹은 `느린 적중`이라 부릅니다.

## 🤔HTTP 재검사가 어떻게 이루어지는지 자세히 알 수 있을까요?

HTTP는 캐시된 객체를 재검사하기 위해 몇 가지 도구를 제공하는데 이 중 가장 많이 쓰이는 것이 `If-Modified-Since` 헤더입니다.

서버에게 보내는 GET 요청에 이 헤더를 추가하면 캐시된 시간 이후에 변경된 경우에만 사본을 보내달라는 의미가 됩니다.

이 요청이 서버에게 도착했을 때 일어나는 경우는 세 가지가 있습니다.

1. 변경되지않을 경우

만약 서버 객체가 변경되지 않았다면 서버는 클라이언트에게 작은 HTTP 304 Modified 응답을 보냅니다.

2. 변경된 경우

만약 서버 객체가 캐시된 사본과 다르다면 서버는 콘텐츠 전체와 함께 평범한 HTTP 200 ok 응답을 보냅니다.

3. 삭제된 경우

만약 서버 객체가 삭제된 경우 서버는 404 Not Found 응답을 돌려보내며 캐시는 사본을 삭제합니다.

## 🤔캐시가 적중된 경우와 부적중된 경우를 어떻게 확인하나요?

불행히도 HTTP는 클라이언트에게 응답이 캐시 적중인지 아니면 원 서버 접근인지 말해줄 수 있는 방법이 제공되지 않습니다.

두 경우 모두 응답코드는 200 OK가 될 것 입니다.

알아내는 방법은 두 가지가 있는데

1. `Date` 헤더 이용

`Date` 헤더 값을 현재 시각과 비교하여, 응답의 생성일이 더 오래되었다면 클라이언트는 응답이 캐시된 것임을 알아낼 수 있습니다.

2. `Age` 헤더 이용

응답이 얼마나 오래되었는지 말해주는 Age헤더를 이용합니다.

3. `X-Cache`: 이 헤더는 웹 캐시 서버가 응답을 제공했는지(적중) 또는 원본 서버에서 직접 가져왔는지(부적중)를 나타냅니다.

`X-Cache: HIT` : 캐시 적중
`X-Cache: MISS` : 캐시 부적중

## 🤔아까는 304 Modified 응답 코드가 온다고 말했는데 캐시 적중과 부적중을 확인할 수 없다는게 무슨소리인가요?

캐시 적중과 부적중은 특정 HTTP 응답 코드로 직접 표시되지 않습니다.

대신 HTTP 응답 코드와 함께 응답 헤더를 통해 캐시 상태를 확인할 수 있습니다.

그러나 특정 응답 코드와 함께 사용되는 경우가 많습니다:

`200 OK`: 캐시 적중 또는 부적중 모두에서 사용될 수 있습니다. 캐시 적중 시에는 캐시에서 가져온 콘텐츠를 의미하고, 부적중 시에는 원본 서버에서 가져온 콘텐츠를 의미합니다.

`304 Not Modified`: 클라이언트가 조건부 요청(If-None-Match 또는 If-Modified-Since 헤더 사용)을 보냈고, 서버가 콘텐츠가 변경되지 않았음을 확인했을 때 사용됩니다.

이 경우 클라이언트는 캐시된 버전을 사용할 수 있습니다.

`캐시 적중`과 `부적중`의 상태는 주로 응답 헤더를 통해 확인합니다.

`X-Cache: HIT` : 캐시 적중

`X-Cache: MISS` : 캐시 부적중

따라서 캐시 상태를 확인하려면 HTTP 응답 코드를 참고하고, 추가적으로 응답 헤더를 확인하는 것이 중요합니다.
