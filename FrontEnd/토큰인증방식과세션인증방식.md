# ✨세션기반인증방식

세션 기반 인증 방식은 `사용자가 로그인하면 서버가 세션을 생성하고, 세션 식별자를 쿠키로 클라이언트에 전송하는 방법`입니다.

클라이언트는 이후 모든 요청에 이 쿠키를 포함시켜 서버에 보내며, 서버는 쿠키의 세션 식별자를 통해 사용자의 인증 상태를 확인하고 요청을 처리합니다.

이 방식은 `서버가 세션을 관리하므로 보안성이 높지만, 서버의 리소스를 많이 사용하고 확장성이 떨어질 수 있습니다.`

# ✨토큰기반인증방식

토큰 기반 인증 방식은 `사용자가 로그인할 때 생성된 고유한 토큰을 통해 인증을 수행하는 방법`입니다.

사용자가 로그인하면 서버는 사용자 정보를 확인한 후 토큰을 생성하여 클라이언트에 반환하고, 클라이언트는 이후 요청에 이 토큰을 포함시켜 서버에 전송합니다.

서버는 요청에 포함된 `토큰을 검증하여 사용자의 인증 상태를 확인하고 요청을 처리`합니다.

이 방식은 서버가 세션을 유지할 필요가 없고 `확장성이 뛰어나며, 주로 RESTful API와 같은 웹 서비스에서 사용`됩니다.

토큰 관리: 토큰의 만료 및 갱신 관리를 클라이언트 측에서 처리해야 합니다.

토큰 탈취: 토큰이 탈취되면, 만료 기간 동안 악용될 수 있습니다.

### 💡 그렇다면 세션 기반 인증과 토큰 기반 인증은 각각 어느 경우에 적합한가요?

`단일 도메인`이라면 `세션 기반 인증을 사용`하고, 아니라면 `토큰 기반 인증을 사용하는 것이 적합`하다고 생각합니다.

왜? - `세션을 관리할 때 사용되는 쿠키`는 `단일 도메인 및 서브 도메인에서만 작동하도록 설계`되어 있기 때문에 여러 도메인에서 관리하는 것은 어렵습니다. (CORS 문제)

# ✨JWT란?

JWT는 `JSON 형식의 데이터를 사용하여 두 당사자 간에 정보를 안전하게 전송하는 토큰`입니다.

로그인 시 서버가 토큰을 생성하여 클라이언트에 보내고, 클라이언트는 이후 요청에 이 토큰을 포함시켜 서버에 전송합니다.

서버는 토큰을 검증하여 사용자의 인증 상태를 확인합니다.

JWT는 서버가 상태를 유지하지 않아도 되며, 확장성이 뛰어나지만, 토큰이 탈취될 경우 문제가 발생할 수 있습니다.

JWT는 JSON Web Token을 의미하며 `헤더(Header).내용(Payload).서명(Signature)로 구성되며 각 파트를 점(.)으로 구분`합니다.

- 헤더(Header) : `토큰의 타입`과 해시 암호화 알고리즘(방식지정)으로 이루어져 있다.
- 내용(Payload) : 토큰에 사용자가 `담고자 하는 정보`를 담는다. 내용에는 Claim이 담겨있고, `JSON(Key/Value)형태의 한 쌍`으로 이루어져 있다.
- 서명(Signature) : 토큰을 인코딩하거나 유효성 검증할 때 사용하는 고유한 `암호화 코드`이다. 헤더와 내용의 값을 인코딩한다.

### 장점

1. 사용자 인증에 필요한 모든 정보는 토큰 자체에 포함하기 때문에 `별도의 인증 저장소가 필요 없습니다.`

2. 다른 유형의 토큰과 비교했을 때 `경량화`되어있습니다. SAML(Security Assertion Markup Language Tokens)이란 토큰이 있지만 이에 비해 훨씬 경량화되어있음.

3. 디코딩했을 때 JSON이 나오기 때문에 JSON을 기반으로 `쉽게 직렬화, 역직렬화가 가능`하다.

### 단점

1. 토큰이 비대해질 경우 당연히 `서버과부화에 영향`을 줄 수 있습니다. (JWT 자체도 길이가 길어서 트래픽 낭비 문제가 있음)

2. 토큰을 `탈취`당할 경우 디코딩했을 때 데이터를 볼 수 있습니다. (페이로드는 암호화된 게 아니라서 누구나 다 열어볼 수 있음)

- 토큰기반인증방식을 구현할 때는 refresh토큰과 access토큰 두개를 기반으로 구현합니다.

- access토큰의 수명은 짧게, refresh토큰의 수명은 길게 합니다.

### 주의할 점

이렇게 access토큰을 얻었다면 그 이후에 요청을 할 때는 HTTP Header - Authorization 또는 HTTP Header - Cookie에 담아 요청을 하게 되는데요. 이 때 다음과 같은 규칙을 지키는 것이 좋습니다.

- Bearer 으로 Bearer 을 앞에 둬서 토큰기반인증방식이라는 것을 알려주어야 합니다.

- https를 사용해야 합니다.

- 쿠키에 저장한다면 sameSite: 'Strict'을 써야 합니다.

- 수명이 짧은 access token을 발급해야 합니다.

- url에 토큰을 전달하지 말아야 합니다

참고로 이러한 점들은 OAuth2.0과 JWT에 관한 표준문서인 RFC 6750, RFC7519를 기반으로 설명합니다.
