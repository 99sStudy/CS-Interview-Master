# ✨CSRF (Cross-Site Request Forgery)란?

CSRF는 `사용자가 의도하지 않은 요청`을 `특정 웹사이트로 보내게 만드는 공격`입니다. 이 공격은 사용자가 `로그인한 상태`에서 `악의적인 웹사이트를 방문할 때 발생`할 수 있습니다.

### 공격 과정

1. 사용자가 CSRF에 취약한 웹사이트에 로그인합니다.
2. 이후 해커가 만든 악성 웹사이트에 접속합니다.
3. 이 악성 웹사이트에는 이미 로그인된 취약한 사이트로 요청을 보내는 코드가 포함되어 있습니다.
4. 해커의 사이트는 사용자의 권한으로 취약한 사이트에 요청을 보내게 되며, 사용자는 이를 인식하지 못합니다.

### 방어 방법

- **SameSite 쿠키 옵션**: SameSite 속성을 사용하여 `쿠키가 어떤 요청에 포함될지를 제어`할 수 있습니다.

  - `Lax`: 기본적으로 CSRF 공격을 어느 정도 방어할 수 있지만, GET 요청에 대해서는 여전히 취약할 수 있습니다.
  - `Strict`: 더 강력한 방어를 제공하며, 동일 출처에서의 요청이 아니면 쿠키가 전송되지 않습니다.

- **CSRF 토큰 사용**: CSRF 공격을 효과적으로 방어하기 위해 CSRF 토큰을 활용하는 것이 좋습니다.
  1. 사용자가 요청을 보내기 전에 서버로부터 CSRF 토큰을 요청합니다.
  2. 서버는 해당 토큰을 생성하여 반환합니다.
  3. 사용자는 요청을 보낼 때 이 토큰을 요청 헤더에 포함시킵니다.
  4. 서버는 요청에 포함된 CSRF 토큰이 유효한지 검증하여, 유효한 요청만 처리합니다.

### 주의사항

- **서브도메인 탈취**: CSRF 공격은 서브도메인에서 발생할 수 있으며, `SameSite 옵션만으로는 완벽하게 방어할 수 없습니다.` 따라서 `CSRF 토큰과 같은 추가적인 방어 수단이 필요`합니다.

## 🤔만약 CSRF토큰이 탈취당한다면 어떻게 해야할까요?

1. HTTPS 사용: 모든 통신을 HTTPS로 암호화하여 중간에 데이터가 탈취되는 것을 방지합니다. 이는 네트워크 스니핑 공격으로부터 보호합니다.

2. `짧은 유효 기간 설정`: CSRF 토큰의 유효 기간을 짧게 설정하여, 탈취된 토큰이 사용될 가능성을 줄입니다.

3. 토큰의 복잡성 증가: CSRF 토큰을 예측하기 어렵고 복잡하게 생성하여, 공격자가 쉽게 토큰을 추측하거나 생성할 수 없도록 합니다.

4. 모니터링 및 경고 시스템: 비정상적인 활동을 모니터링하고, 의심스러운 요청에 대해 경고를 발생시키는 시스템을 구축합니다.

5. 사용자 인증 강화: 중요한 작업(예: 계좌 변경, 결제 등)에 대해 추가 인증 단계(예: 2단계 인증)를 요구하여 보안을 강화합니다.
