# ✨JWT토큰에 대해 Authorization Header에 토큰 값을 넣어서 리퀘스트를 날려야 되는 데이터가 있을 때 토큰을 어떤 방식으로 관리를 해야 안전하게 브라우저에서 탈취를 당하지 않고 관리 할 수 있는 방법이 있는지 말씀해주세요.

### 1. 저장 위치

- **HTTP Only 쿠키 사용**:

  - JWT를 클라이언트 측의 로컬 스토리지나 세션 스토리지 대신 HTTP Only 쿠키에 저장하는 것이 좋습니다. HTTP Only 쿠키는 JavaScript에서 접근할 수 없기 때문에 XSS(교차 사이트 스크립팅) 공격으로부터 보호됩니다.
  - 쿠키를 설정할 때 `Secure` 플래그를 추가하여 HTTPS를 통해서만 전송되도록 합니다.

  ```javascript
  // 예시: JWT를 HTTP Only 쿠키에 저장
  document.cookie = "token=your_jwt_token; HttpOnly; Secure; SameSite=Strict";
  ```

- **로컬 스토리지/세션 스토리지**:
  - 불가피하게 로컬 스토리지를 사용해야 하는 경우, XSS 공격에 노출될 수 있는 위험이 있으므로, 이 방법은 권장되지 않습니다. 하지만, 만약 필요한 경우에는 데이터 인코딩이나 암호화를 통해 추가적인 보안을 고려해야 합니다.

### 2. 전송 보안

- **HTTPS 사용**:
  - 모든 요청은 HTTPS를 통해 전송해야 합니다. HTTPS는 데이터 전송 중에 중간자 공격을 방지하고, 데이터의 무결성을 보장합니다.

### 3. 토큰 만료 및 갱신

- **짧은 만료 시간 설정**:
  - JWT의 만료 시간을 짧게 설정하여 토큰이 탈취되더라도 피해를 최소화합니다. 예를 들어, 15분 또는 30분으로 설정할 수 있습니다.
- **리프레시 토큰 사용**:
  - 짧은 만료 시간을 가진 액세스 토큰과, 더 긴 만료 시간을 가진 리프레시 토큰을 함께 사용하여 사용자 경험을 개선하고 보안을 강화합니다. 리프레시 토큰은 HTTP Only 쿠키에 저장하는 것이 좋습니다.

### 4. CSRF 방어

- **CSRF 방어**:

  - 만약 JWT를 쿠키에 저장한다면, CSRF(교차 사이트 요청 위조) 공격에 대비해야 합니다. CSRF 공격을 방지하기 위해 CSRF 토큰을 사용하거나 `SameSite` 속성을 설정하여 쿠키가 다른 사이트의 요청에 사용되지 않도록 합니다.

  ```javascript
  document.cookie = "token=your_jwt_token; SameSite=Lax"; // 또는 Strict
  ```

### 5. XSS 방어

- **XSS 방어**:
  - XSS 공격을 방지하기 위해, 사용자 입력을 적절히 검증하고 인코딩합니다. 예를 들어, HTML을 출력할 때는 HTML 인코딩을 사용하여 스크립트가 실행되지 않도록 합니다.

### 6. 토큰 검증

- **서버에서 토큰 검증**:
  - 서버에서 JWT를 받을 때, 항상 서명(signature)을 검증해야 합니다. 이를 통해 토큰이 변조되지 않았는지 확인합니다.

### 결론

JWT를 안전하게 관리하기 위해서는 `HTTP Only 쿠키에 저장`하고, `HTTPS를 사용`하며, `짧은 만료 시간`과 `리프레시 토큰`을 활용하는 것이 좋습니다.

또한, `XSS와 CSRF 공격에 대비한 보안 조치를 마련`하여 전체적인 보안을 강화해야 합니다.

이러한 방법들을 통해 JWT의 안전성을 높이고, 사용자 데이터를 보호할 수 있습니다.
