# ✨JWT토큰에 대해 Authorization Header에 토큰 값을 넣어서 리퀘스트를 날려야 되는 데이터가 있을 때 토큰을 어떤 방식으로 관리를 해야 안전하게 브라우저에서 탈취를 당하지 않고 관리 할 수 있는 방법이 있는지 말씀해주세요.

### 1. 저장 위치

- **HTTP Only 쿠키 사용**:

  - JWT를 클라이언트 측의 로컬 스토리지나 세션 스토리지 대신 HTTP Only 쿠키에 저장하는 것이 좋습니다. HTTP Only 쿠키는 JavaScript에서 접근할 수 없기 때문에 XSS(교차 사이트 스크립팅) 공격으로부터 보호됩니다.
  - 쿠키를 설정할 때 `Secure` 플래그를 추가하여 HTTPS를 통해서만 전송되도록 합니다.

  ```javascript
  // 예시: JWT를 HTTP Only 쿠키에 저장
  document.cookie = "token=your_jwt_token; HttpOnly; Secure; SameSite=Strict";
  ```

### 2. 전송 보안

- **HTTPS 사용**:
  - 모든 요청은 HTTPS를 통해 전송해야 합니다. HTTPS는 데이터 전송 중에 중간자 공격을 방지하고, 데이터의 무결성을 보장합니다.

### 3. 토큰 만료 및 갱신

- **짧은 만료 시간 설정**:
  - JWT의 만료 시간을 짧게 설정하여 토큰이 탈취되더라도 피해를 최소화합니다. 예를 들어, 15분 또는 30분으로 설정할 수 있습니다.
- **리프레시 토큰 사용**:
  - 짧은 만료 시간을 가진 액세스 토큰과, 더 긴 만료 시간을 가진 리프레시 토큰을 함께 사용하여 사용자 경험을 개선하고 보안을 강화합니다. 리프레시 토큰은 HTTP Only 쿠키에 저장하는 것이 좋습니다.

### 4. CSRF 방어

- **CSRF 방어**:

  - 만약 JWT를 쿠키에 저장한다면, CSRF(교차 사이트 요청 위조) 공격에 대비해야 합니다. CSRF 공격을 방지하기 위해 CSRF 토큰을 사용하거나 `SameSite` 속성을 설정하여 쿠키가 다른 사이트의 요청에 사용되지 않도록 합니다.

  ```javascript
  document.cookie = "token=your_jwt_token; SameSite=Lax"; // 또는 Strict
  ```

### 5. XSS 방어

- **XSS 방어**:
  - XSS 공격을 방지하기 위해, 사용자 입력을 적절히 검증하고 인코딩합니다. 예를 들어, HTML을 출력할 때는 `HTML 인코딩을 사용`하여 스크립트가 실행되지 않도록 합니다.

### 6. 토큰 검증

- **서버에서 토큰 검증**:
  - 서버에서 JWT를 받을 때, 항상 서명(signature)을 검증해야 합니다. 이를 통해 토큰이 변조되지 않았는지 확인합니다.

### 결론

JWT를 안전하게 관리하기 위해서는 `HTTP Only 쿠키에 저장`하고, `HTTPS를 사용`하며, `짧은 만료 시간`과 `리프레시 토큰`을 활용하는 것이 좋습니다.

또한, `XSS와 CSRF 공격에 대비한 보안 조치를 마련`하여 전체적인 보안을 강화해야 합니다.

이러한 방법들을 통해 JWT의 안전성을 높이고, 사용자 데이터를 보호할 수 있습니다.

<hr/>

# ✨토큰 기반 인증 방식에 대해 설명해주세요. 그리고 JWT 토큰을 쿠키에 저장했을 때 취약점에 대해 설명해주세요.

### 토큰 기반 인증 방식

토큰 기반 인증은 `사용자가 로그인할 때 서버가 사용자에게 토큰을 발급`하고, 이후 요청 시 이 `토큰을 사용하여 인증하는 방식`입니다. 이 방식의 주요 단계는 다음과 같습니다:

1. **로그인**: 사용자가 로그인 정보를 입력하고, 서버에 이를 전송합니다.
2. **토큰 발급**: 서버는 사용자 인증에 성공하면, 사용자의 정보를 담은 토큰을 생성하여 클라이언트에 반환합니다.
3. **토큰 저장**: 클라이언트는 반환받은 토큰을 로컬 스토리지, 세션 스토리지, 또는 쿠키에 저장합니다.
4. **인증 요청**: 이후 클라이언트는 요청을 보낼 때마다 저장된 토큰을 함께 전송합니다.
5. **토큰 검증**: 서버는 요청을 받을 때마다 토큰을 검증하여 사용자의 인증 상태를 확인합니다.

이 방식의 장점은 상태를 유지할 필요가 없고, 여러 서버 간에 쉽게 인증 정보를 공유할 수 있다는 점입니다. 또한 RESTful API와 잘 어울리며, 다양한 클라이언트에서 사용할 수 있습니다.

### JWT 토큰의 취약점 (쿠키에 저장했을 때)

JWT를 쿠키에 저장할 때 발생할 수 있는 주요 취약점은 다음과 같습니다:

1. **XSS (교차 사이트 스크립팅)**: 웹 애플리케이션이 `XSS 취약점`이 있는 경우, 공격자가 악성 스크립트를 주입하여 사용자의 `쿠키에 저장된 JWT를 탈취`할 수 있습니다. 이는 공격자가 사용자 세션을 탈취하는 결과로 이어질 수 있습니다. 해결방법: `HTML인코딩 사용`

2. **CSRF (교차 사이트 요청 위조)**: JWT가 쿠키에 저장되면, 사용자가 `해당 도메인을 방문할 때마다 자동으로 쿠키가 전송`됩니다. 공격자가 악의적인 요청을 만들고, 사용자가 해당 요청을 실행하게 하면 `사용자의 인증 정보가 악용`될 수 있습니다.

3. **쿠키 탈취**: 만약 HTTP만을 사용하는 경우, 네트워크 트래픽 중간에 공격자가 `쿠키를 가로챌 수 있습니다.` 이를 방지하기 위해 `HTTPS를 사용`해야 합니다.

4. **토큰 만료**: JWT는 일반적으로 `만료 시간`이 있습니다. 만약 만료 시간 설정이 `적절하지 않거나 너무 길면`, 공격자가 `탈취한 토큰을 오랜 시간 동안 사용`할 수 있는 위험이 있습니다.

5. **쿠키 설정 취약점**: 쿠키의 `HttpOnly` 및 `Secure` 속성을 설정하지 않으면 보안이 저하됩니다. `HttpOnly`를 사용하면 `JavaScript에서 쿠키에 접근할 수 없게` 하고, `Secure`를 설정하면 `HTTPS 연결에서만 쿠키가 전송`됩니다.
